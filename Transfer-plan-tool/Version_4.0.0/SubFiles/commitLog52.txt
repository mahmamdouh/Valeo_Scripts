b'commit 11a95eb83bd76ab9f9527bc10d8f281f901f4a1a
Author: Murali-Krishna VEERAGANDHAM (JV) <murali-krishna.veeragandham.jv@valeo.com>
Date:   Mon Jan 24 14:47:59 2022 +0100

    $100kW-48216$ - BswFpgaIf implementation for SftyE2eFpga Arch update
    
    Change-Id: Iad572fd92c7d64c57de57e0bbd57eef6cf35a74f

diff --git a/src/fw_cu/Components/Inv/ValMeasAndProc/BswFpgaIf/src/BswFpgaIf.c b/src/fw_cu/Components/Inv/ValMeasAndProc/BswFpgaIf/src/BswFpgaIf.c
index a4a937923..1278aace8 100644
--- a/src/fw_cu/Components/Inv/ValMeasAndProc/BswFpgaIf/src/BswFpgaIf.c
+++ b/src/fw_cu/Components/Inv/ValMeasAndProc/BswFpgaIf/src/BswFpgaIf.c
@@ -217,26 +217,6 @@ uint16 BswFpgaIf_IPhaRawVal_2[SYSDEF_EM_PHA_CNT_MAX];
 */
 uint16 BswFpgaIf_UdcRawVal;
 
-/*
-@@ SYMBOL = BswFpgaIfFltRstAckKl15
-@@ A2L_TYPE = MEASURE
-@@ DATA_TYPE = ULONG
-@@ DESCRIPTION = "KL15 fault reset request ack counter"
-@@ GROUP = BswFpgaIf
-@@ END
-*/
-static uint32 BswFpgaIfFltRstAckKl15;
-
-/*
-@@ SYMBOL = BswFpgaIfFltRstAckClrDtc
-@@ A2L_TYPE = MEASURE
-@@ DATA_TYPE = ULONG
-@@ DESCRIPTION = "Clear DTC fault reset request ack counter"
-@@ GROUP = BswFpgaIf
-@@ END
-*/
-static uint32 BswFpgaIfFltRstAckClrDtc;
-
 #define ISWIF_STOP_SEC_VAR_FAST_CLEARED
 #include "MemMap.h"
 
@@ -1596,37 +1576,11 @@ uint8 BswFpgaIf_SetTxAsyncData(void)
 {
    uint8 Mode = BSWFPGAIF_MODE_INIT;
 
-    if((BswFpgaIfReiniCombinedFltOvrdEna != 0u) || (ErrDebFltRstReqKl15 != BswFpgaIfFltRstAckKl15) || (ErrDebFltRstReqClrDtc != BswFpgaIfFltRstAckClrDtc))
-    {
-      BswFpgaIfTxaFault_A_Data = (uint16)BswFpgaIfReiniCombinedFltOvrdVal;
-      BswFpgaIfTxaFault_B_Data = (uint16)BswFpgaIfReiniCombinedFltOvrdVal;
-      BswFpgaIfFltRstAckKl15 = ErrDebFltRstReqKl15;
-      BswFpgaIfFltRstAckClrDtc = ErrDebFltRstReqClrDtc;
-    }
-    else
-    {
-      BswFpgaIfTxaFault_A_Data = (uint16)0x0u;
-      BswFpgaIfTxaFault_B_Data = (uint16)0x0u;
-    }
-    VSISRV_SetSignalFaultA(BswFpgaIfTxaFault_A_Data);
-    VSISRV_SetSignalFaultB(BswFpgaIfTxaFault_B_Data);
-
-    if (SftyC2cData.ActvDchaReq == TRUE)
-    {
-        VSISRV_SetSignalStateReqModeReq(BSWFPGAIF_MODE_ACTIVE_DISCHARGE);
-      Mode = BSWFPGAIF_MODE_ACTIVE_DISCHARGE;
-    }
-    else if ((SftyC2cData.ActvDchaReq == FALSE ) && (BswC2cData.EmmMode == EMM_TRQCTRL_MODE) && ((VSISRV_GetFrameFS_SOL() == 1) && (VSISRV_GetFrameFS_SOE() == 1)))
-    {
-       VSISRV_SetSignalStateReqModeReq(BSWFPGAIF_MODE_PWM_DIRECT);
-      Mode = BSWFPGAIF_MODE_PWM_DIRECT;
-    }
-    else if ((SftyC2cData.ActvDchaReq == FALSE ) && ((BswC2cData.EmmMode == EMM_STANDBY_MODE) || (BswC2cData.EmmMode == EMM_SLEEP_MODE)))
-    {
-       VSISRV_SetSignalStateReqModeReq(BSWFPGAIF_MODE_INIT);
-         Mode = BSWFPGAIF_MODE_INIT;
-    }
-    return Mode;
+   VSISRV_SetSignalFaultA(SftyC2cData.FpgaTxDataFltAReinitSt.U);
+   VSISRV_SetSignalFaultB(SftyC2cData.FpgaTxDataFltBReinitSt.U);
+   VSISRV_SetSignalStateReqModeReq(SftyC2cData.FpgaStateReq.B.Mode);
+   Mode = SftyC2cData.FpgaStateReq.B.Mode;
+   return Mode;
 }
 
 /******************************************************************/
@@ -1652,7 +1606,7 @@ void BswFpgaIf_TxRx1ms(void)
     Pwm3PhaMuxDutyCycPha_V = (( 1 - PwmSpMuxDutyCycPha[SYSDEF_PHA_V] ) * 4000 );
     Pwm3PhaMuxDutyCycPha_W = (( 1 - PwmSpMuxDutyCycPha[SYSDEF_PHA_W] ) * 4000 );
 
-    VSISRV_SetSignalM0Id2Spare06To11(0);
+   VSISRV_SetSignalM0Id2Spare06To11(((uint8)SftyC2cData.FpgaActvDchaReq << 3u) & 0x08u);
    VSISRV_SetSignalDebug(0);
    VSISRV_SetSignalPwrSupDrvInh(0);
    VSISRV_SetSignalPwrSupHbrInh(0);
@@ -1676,7 +1630,7 @@ void BswFpgaIf_TxRx1ms(void)
 
       case BSWFPGAIF_TXID1 :
 
-         VSISRV_SetSignalPwmInitValVl(Pwm3PhaMuxDutyCycPha_V);
+        VSISRV_SetSignalPwmInitValVl(Pwm3PhaMuxDutyCycPha_V);
         VSISRV_SetSignalPwmInitValVr(Pwm3PhaMuxDutyCycPha_V);
         VSISRV_SetSignalPwmInitValWl(Pwm3PhaMuxDutyCycPha_W);
         VSISRV_SetSignalPwmInitValWr(Pwm3PhaMuxDutyCycPha_W);
diff --git a/src/fw_cu/build/a2l/Measurements-to-Timeslices-Mapping.csv b/src/fw_cu/build/a2l/Measurements-to-Timeslices-Mapping.csv
index 9198c0adf..248e75100 100644
--- a/src/fw_cu/build/a2l/Measurements-to-Timeslices-Mapping.csv
+++ b/src/fw_cu/build/a2l/Measurements-to-Timeslices-Mapping.csv
@@ -7178,8 +7178,6 @@ DrvCtrlSdlRbl1msFpgaSetTx.RunTi,Core_2,C2_1ms,1,,,SWIT
 SftyAcEvlnRxCrcErrMonrSt,Core_1,Core_1_200us,0.2,,,SSW
 SftyAcEvlnSetOverCurrPhaReinitSt,Core_1,Core_1_200us,0.2,,,SSW
 SftyAcEvlnSetPlausReinitSt,Core_1,Core_1_200us,0.2,,,SSW
-BswFpgaIfFltRstAckKl15,Core_2,C2_100u_PWM,0.1,,,DRCO
-BswFpgaIfFltRstAckClrDtc,Core_2,C2_100u_PWM,0.1,,,DRCO
 SftyInvActrEmgySwFltSts,Core_1,Core_1_200us,0.2,,,SSW
 SftyInvActrEmmMode,Core_1,Core_1_200us,0.2,,,SSW
 SftyInvActrSCSpdReadyFltSts,Core_1,Core_1_200us,0.2,,,SSW
'
